const Apollo = {
    empty: "hiker://empty",
    url: config.host ? config.host.replace(/\/$/, "") : "https://javlist.me",
    d: [],
    data: {
        category: getMyVar('Apo.category', '0'),
        subCate: getMyVar('Apo.subCate', '0'),
    },
    baseParse: () => {
        const page = parseInt(MY_URL.split('##')[2])
        let categoryList = [{
            "title": "æ’è¡Œæ¦œ",
            "path": "/top100.php",
            "type": "video",
            "sub": []
        }, {
            "title": "åˆ†ç±»â–¼",
            "path": "/default.cpp",
            "type": "video",
            "sub": [{
                "title": "æœ‰ç ",
                "path": "/default.cpp?year=07811dc6c422334ce36a09ff5cd6fe71&Ttype=2&other=dc1194d6780ae1741469b7fea8f61b02&t1=&t2=&t3=&t4=&t5=&t6=&t7="
            }, {
                "title": "æ— ç ",
                "path": "/uncensored.c?year=07811dc6c422334ce36a09ff5cd6fe71&tag=all&other=dc1194d6780ae1741469b7fea8f61b02&ytype=2&Ttype=2&sort=DESC"
            }, {
                "title": "æ¬§ç¾",
                "path": "/western.java?year=07811dc6c422334ce36a09ff5cd6fe71&tag=all&other=dc1194d6780ae1741469b7fea8f61b02&ytype=2&Ttype=2&sort=DESC"
            }, {
                "title": "å›½äº§",
                "path": "/domestic_index.js?year=07811dc6c422334ce36a09ff5cd6fe71&tag=all&other=dc1194d6780ae1741469b7fea8f61b02&ytype=2&Ttype=2&sort=DESC"
            }, {
                "title": "FC2ç£åŠ›æŸ¥è¯¢",
                "path": "https://fc2.a-91.top/default.cpp?year=07811dc6c422334ce36a09ff5cd6fe71&tag=all&other=dc1194d6780ae1741469b7fea8f61b02&ytype=2&Ttype=2&sort=DESC"
            }, {
                "title": "è§†é¢‘åœ¨çº¿",
                "path": "https://vod001.a-91.top/"
            }]
        }, {
            "title": "æ ‡ç­¾åˆ†ç±»â–¼",
            "path": "/cat.py?type=rpCNLOP1WDRnR2LjHsExtQ==",
            "type": "avatar",
            "sub": [{
                "title": "æœ‰ç ç‰‡å•†",
                "path": "/cat.py?type=rpCNLOP1WDRnR2LjHsExtQ=="
            }, {
                "title": "æœ‰ç å¥³ä¼˜",
                "path": "/cat.py?type=0TActtgu02YfLieZ7SleLw=="
            }, {
                "title": "æ— ç ç‰‡å•†",
                "path": "/uncensored_cat.py?type=rpCNLOP1WDRnR2LjHsExtQ=="
            }, {
                "title": "æ— ç å¥³ä¼˜",
                "path": "/uncensored_cat.py?type=0TActtgu02YfLieZ7SleLw=="
            }, {
                "title": "æ¬§ç¾ç‰‡å•†",
                "path": "/western_cat.java?type=WBvfQ1QROghlcRTERGmhww=="
            }, {
                "title": "æ¬§ç¾å¥³ä¼˜",
                "path": "/western_cat.java?type=0TActtgu02YfLieZ7SleLw=="
            }, {
                "title": "å›½äº§å¥³ä¼˜",
                "path": "/domestic_cat.py?type=0TActtgu02YfLieZ7SleLw=="
            }]
        }, {
            "title": "æœç´¢â–¼",
            "path": "/search.php",
            "type": "search",
            "sub": [{
                "title": "æœ‰ç æŸ¥è¯¢",
                "path": "/search.php"
            }, {
                "title": "æ— ç æŸ¥è¯¢",
                "path": "/uncensored_search.php"
            }, {
                "title": "æ¬§ç¾æŸ¥è¯¢",
                "path": "/western_search.java"
            }, {
                "title": "å›½äº§æŸ¥è¯¢",
                "path": "/domestic_search.php"
            }]
        }]
        const currentCate = categoryList[Apollo.data.category]
        let url
        let type = currentCate.type
        let title = currentCate.title
        if (currentCate.sub.length > 0) {
            url = currentCate.sub[Apollo.data.subCate].path.startsWith("http") ? getMyVar("url", currentCate.sub[Apollo.data.subCate].path) : Apollo.url + getMyVar("url", currentCate.sub[Apollo.data.subCate].path)
            url = url.startsWith("http") ? url : getHome(currentCate.sub[Apollo.data.subCate].path) + url
            title = currentCate.sub[Apollo.data.subCate].title
        } else {
            url = Apollo.url + getMyVar("url", currentCate.path)
        }

        if (page === 1) {
            categoryList.forEach((cate, index) => {
                Apollo.d.push({
                    title: parseInt(Apollo.data.category) === index ? 'â€˜â€˜â€™â€™<strong><font color="#ff1493">' + cate.title + '</font></strong>' : cate.title,
                    url: $(Apollo.empty + "#noLoading#")
                        .lazyRule((index) => {
                        putMyVar("Apo.category", index.toString())
                        putMyVar("Apo.subCate", '0')
                        clearMyVar("sort")
                        clearMyVar("url")
                        refreshPage(true)
                        return "hiker://empty"
                    }, index),
                    col_type: 'scroll_button',
                })
            })
            Apollo.d.push({
                col_type: 'blank_block',
            })
            if (currentCate.sub.length > 0) {
                currentCate.sub.forEach((cate, index) => {
                    Apollo.d.push({
                        title: parseInt(Apollo.data.subCate) === index ? 'â€˜â€˜â€™â€™<strong><font color="#ff1493">' + cate.title + '</font></strong>' : cate.title,
                        url: $(Apollo.empty + "#noLoading#")
                            .lazyRule((index) => {
                            putMyVar("Apo.subCate", index.toString())
                            clearMyVar("sort")
                            clearMyVar("url")
                            refreshPage(true)
                            return "hiker://empty"
                        }, index),
                        col_type: 'scroll_button',
                    })
                })
                Apollo.d.push({
                    col_type: "blank_block",
                })
            }
        }
        /*       //ç¿»é¡µ
        if (page !== 1) {
            url = url.includes("?") ? url + "&page=" + page : url + "?page=" + page
        }*/
        let nextPage = getMyVar("nextPage", "");
        if (nextPage && MY_PAGE > 1) {
            url = getHome(url) + nextPage;
        } else if (MY_PAGE > 1) {
            url = "æ²¡æœ‰ä¸‹ä¸€é¡µå“¦ğŸ˜‘"
        }
        const html = fetch(url, {
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0)'
            }
        })
        log(url)
        try {
            var next = pdfh(html, "#page&&a:matches(ä¸‹ä¸€é¡µ)&&href")
            putMyVar("nextPage", next);
        } catch {
            clearMyVar("nextPage");
            //log("å¯èƒ½ä¸å­˜åœ¨ä¸‹ä¸€é¡µæˆ–è€…ä¸‹ä¸€é¡µå®šä½æœ‰é—®é¢˜");
        }

        if (title !== "è§†é¢‘åœ¨çº¿") {
            Apollo.dtfenlei(html, url)
        }
        switch (type) {
            case 'video':
                if (title == "è§†é¢‘åœ¨çº¿") {
                    Apollo.videoOnline(html, url)
                } else {
                    Apollo.videoType(html, url)
                }
                break
            case 'avatar':
                Apollo.avatarType(html, url)
                break
            case 'search':
                Apollo.searchType(html, url)
                Apollo.avatarType(html, url)
                Apollo.d.push({
                    col_type: "blank_block",
                })
                Apollo.videoType(html, url)
                break
            default:
                Apollo.videoType(html, url)
        }
        setResult(Apollo.d)
    },

    //ä¸€çº§sort
    videoSort: (html, url) => {
        /* Apollo.d.push({
            col_type: "blank_block",
        })*/
        const sort = pdfa(html, '.filters&&.filter-item&&a')
        sort.forEach((item, index) => {
            var title = pdfh(item, 'Text');
            Apollo.d.push({
                title: getMyVar('ysort', '0') == index ? 'â€˜â€˜â€™â€™<strong><font color="#ff1493">' + title + '</font></strong>' : title,
                url: getHome(url) + pdfh(item, 'a&&href') + $('#noLoading#')
                    .lazyRule((index) => {
                    putMyVar('ysort', index);
                    putMyVar("yurl", input);
                    refreshPage(false);
                    return 'hiker://empty'
                }, index),
                col_type: 'scroll_button'
            })
        })
    },

    //åŠ¨æ€åˆ†ç±»
    dtfenlei: (html, url) => {
        const åˆ†ç±»é¢œè‰² = '#ff1493'
        const å¤§ç±»å®šä½ = '.filters&&.filter-item:not(:matches(åˆ†ç±»))'
        const æ‹¼æ¥åˆ†ç±» = ''
        const å°ç±»å®šä½ = 'body&&a:not(:matches(æ”¶èµ·))'
        const åˆ†ç±»æ ‡é¢˜ = 'a&&Text'
        const åˆ†ç±»é“¾æ¥ = 'a&&href'
        try {
            var categories = pdfa(html, å¤§ç±»å®šä½)
                .concat(pdfa(html, æ‹¼æ¥åˆ†ç±»))
        } catch (e) {
            var categories = pdfa(html, å¤§ç±»å®šä½)
        }
        let init_cate = []
        for (let i = 0; i < 20; i++) {
            init_cate.push("0")
        }
        const cate_temp_json = getMyVar("sort", JSON.stringify(init_cate))
        const cate_temp = JSON.parse(cate_temp_json)
        const catlgth = categories.length - 1
        if (MY_PAGE === 1) {
            categories.forEach((category, index) => {
                let sub_categories = pdfa(category, å°ç±»å®šä½);
                if (index == catlgth) {
                    var cili = sub_categories.splice(1, 1)[0]
                    sub_categories.unshift(cili)
                }
                sub_categories = sub_categories.filter(t => pdfh(t, 'a&&Text')
                    .trim() !== '');
                let genre_title = pdfa(category, "body&&span")
                    .map(t => pdfh(t, "Text"));
                sub_categories.forEach((item, key) => {
                    let title = pdfh(item, åˆ†ç±»æ ‡é¢˜)
                    if (key === 0) {
                        title = title.replace("å…¨éƒ¨", genre_title[0])
                    }
                    Apollo.d.push({
                        title: key.toString() === cate_temp[index] ? 'â€œâ€œâ€â€<b><span style="color: ' + åˆ†ç±»é¢œè‰² + '">' + title + '</span></b>' : title,
                        url: $(pdfh(item, åˆ†ç±»é“¾æ¥) + '#noLoading#')
                            .lazyRule((params) => {
                            params.cate_temp[params.index] = params.key.toString()

                            putMyVar("sort", JSON.stringify(params.cate_temp))
                            putMyVar("url", input)
                            refreshPage(true)
                            return "hiker://empty"
                        }, {
                            cate_temp: cate_temp,
                            index: index,
                            key: key,
                            page: MY_PAGE,
                        }),
                        col_type: 'scroll_button',
                    })
                })
                Apollo.d.push({
                    col_type: "blank_block"
                });
            })
        }
    },

    //ä¸€çº§è§†é¢‘åˆ—è¡¨
    videoType: (html, url) => {
        var list = pdfa(html, "#posts&&.post");
        list.forEach(item => {
            var title = pdfh(item, ".time,1&&Text")
                .toUpperCase() + "\t" + pdfh(item, "h3&&Text");
            var img = pdfh(item, "img&&src");
            Apollo.d.push({
                title: title,
                desc: pdfh(item, ".vip-tag&&Text")
                    .toUpperCase() + "\t\tğŸ“…" + pdfh(item, ".time&&Text"),
                img: img.includes("domestic") ? img : img.replace("thumbnail-", ""),
                url: $(getHome(url) + pdfh(item, 'a&&href') + '#noHistory#')
                    .rule(() => {
                    const Apollo = $.require('hiker://page/Apollo')
                    Apollo.videoParse(MY_URL)
                    setResult(Apollo.d)
                }),
                col_type: "movie_2",
                extra: {
                    pageTitle: title,
                    title: title
                }
            })
        })
    },

    //ä¸€çº§åœ¨çº¿è§†é¢‘
    videoOnline: (html, url) => {
        var list = pdfa(html, "#posts&&.post");
        list.forEach(item => {
            var title = pdfh(item, "h3&&Text");
            var img = pdfh(item, "img&&src");
            Apollo.d.push({
                title: title,
                desc: "\t\tğŸ“…" + pdfh(item, ".time&&Text"),
                img: img.includes("domestic") ? img : img.replace("thumbnail-", ""),
                url: $(getHome(url) + pdfh(item, 'a&&href') + '#noHistory#')
                    .lazyRule(() => {
                    const html = fetch(input, {
                        headers: {
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0)'
                        }
                    })
                    var binaryStr = html.match(/decodeBinaryString\('(.*?)'\)/)[1]

                        function decodeBinaryString(binaryStr) {
                            var result = "";
                            for (var i = 0; i < binaryStr.length; i += 8) {
                                var byte = binaryStr.substr(i, 8);
                                result += String.fromCharCode(parseInt(byte, 2));
                            }
                            return base64Decode(base64Decode(result));
                        }
                    var result = decodeBinaryString(binaryStr)
                    return pdfh(result, "source&&src")
                }),
                col_type: "movie_2",
            })
        })
    },

    //ä¸€çº§æ¼”å‘˜
    avatarType: (html, url) => {
        var list = pdfa(html, '.content.tagslist&&li')
        list.forEach(item => {
            Apollo.d.push({
                title: pdfh(item, 'a&&Text'),
                desc: "",
                pic_url: pdfh(item, 'img&&src')
                    .startsWith("http") ? pdfh(item, 'img&&src') : 'https://img.vinua.cn/images/IQ3h0.jpg',
                url: $(getHome(url) + pdfh(item, 'a&&href') + '#fypage#noHistory#')
                    .rule(() => {
                    const Apollo = $.require('hiker://page/Apollo')
                    Apollo.avatarParse(MY_URL)
                    setResult(Apollo.d)
                }),
                col_type: 'card_pic_3'
            })
        })
    },

    searchType: (html, url) => {
        if (MY_PAGE == 1) {
            var list = pdfa(html, ".search-container&&option")
            var action = pdfh(html, "form&&action")
            list.forEach((item, index) => {
                var value = pdfh(item, "option&&value");
                var title = pdfh(item, "Text");
                Apollo.d.push({
                    title: "ğŸ”" + title,
                    url: $.toString((action, value, index) => {
                        surl = action + "?SearchType=" + value + "&s=" + input;
                        putMyVar('ssou', index);
                        putMyVar('value', input);
                        putMyVar('url', surl)
                        refreshPage(true);
                        return 'hiker://empty';
                    }, action, value, index),
                    desc: 'ç¾å¥½å³åˆ»å¼€å§‹...',
                    col_type: "input",
                    extra: getMyVar("ssou") == index ? {
                        defaultValue: getMyVar('value', '') || "",
                        onChange: "putMyVar('value', input);"
                    } : ""
                });
            })
        }
    },

    //ä¸€çº§é¡µé¢.ç®€
    avatarParse: (url) => {
        addListener("onClose", $.toString(() => {
            clearMyVar("yurl");
            clearMyVar("ysort");
        }));
        url = getMyVar("yurl", url)
            .replace(/(.*?)#.*/, "$1");
        if (MY_PAGE !== 1) {
            url = url.includes("?") ? url + "&page=" + MY_PAGE : url + "?page=" + MY_PAGE
        }
        const html = fetch(url, {
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0)'
            }
        })
        log(url)
        if (MY_PAGE === 1) {
            Apollo.videoSort(html, url)
        }
        Apollo.videoType(html, url)
    },

    //æœç´¢
    searchParse: (url) => {
        url = Apollo.url + url.replace("hiker://empty##", "")
        log(url)
        const html = fetch(url, {
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0)'
            }
        });
        Apollo.videoType(html, url)
        setResult(Apollo.d)
    },

    niutrans: (text) => {
        try {
            var url = "https://api.niutrans.com/NiuTransServer/translation";
            var api = config.api;
            if (api) {
                if (text != "") {
                    var lang = "https://test.niutrans.com/NiuTransServer/language?src_text=" + text + "&source=text";
                    var from = JSON.parse(fetch(lang, {
                        timeout: 1000
                    }))
                        .language;
                    var result = post(url, {
                        body: {
                            src_text: text,
                            from: from,
                            to: "zh",
                            apikey: api,
                        },
                        timeout: 1223
                    });
                    var data = JSON.parse(result)
                    if (data.tgt_text) {
                        return data.tgt_text
                    } else {
                        log("ç¿»è¯‘å¤±è´¥ï¼Œä½¿ç”¨åŸæ–‡");
                        return text
                    }
                } else {
                    log("ç¿»è¯‘å¤±è´¥ï¼ŒåŸæ–‡ä¸ºç©º");
                    return text
                }
            } else {
                toast("é¢„å¤„ç†è¯·å¡«å†™ç¿»è¯‘api")
                return text
            }
        } catch {
            log("ç¿»è¯‘å¤±è´¥ï¼Œä½¿ç”¨åŸæ–‡");
            return text
        }
    },

    yiyanParse: (html) => {
        //author:ç²‰å¦¹
        function save_day_say_cache() {
            let day_say_cache = {}
            let day_say_html = fetch('https://v1.hitokoto.cn', {
                headers: {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36',
                },
            })
            day_say_html = JSON.parse(day_say_html)
            day_say_cache['content'] = day_say_html['hitokoto']
            day_say_cache['time'] = Math.floor(Date.now() / 1000)
            globalMap0.putMyVar('daysay', day_say_cache)
            return day_say_html['hitokoto']
        }

        let day_say = ''
        try {
            let day_say_cache = {}
            let day_time = 0
            if (globalMap0.hasMyVar('daysay')) {
                day_say_cache = globalMap0.getMyVar('daysay', {})
                day_time = day_say_cache['time']
                if (Math.floor(Date.now() / 1000) - day_time >= 600) {
                    day_say = save_day_say_cache()
                } else {
                    day_say = day_say_cache['content']
                }
            } else {
                day_say = save_day_say_cache()
            }
        } catch {
            day_say = ''
        }
        var story = pdfh(html, "body&&h2:matches(æ•…äº‹)+table&&Text")
        var content = Apollo.niutrans(story)
        var lazy = $(`#noLoading#`)
            .lazyRule((content) => {
            if (content !== "") {
                var title = findItem('content_decid')
                    .title
                if (title.includes("<br>\t")) {
                    updateItem("content_decid", {
                        title: title.replace(/(.*?)<br>\t.*/, "$1"),
                    })
                } else {
                    updateItem("content_decid", {
                        title: title.replace(/(.*?)<br>\t.*/, "$1") + '<br>\t\t\t\t\t\t\t' + content.small()
                            .fontcolor("#8A2BE2"),
                    })
                }
                return "hiker://empty"
            } else {
                return "toast://æ­¤ç¯‡æ²¡æœ‰æ•…äº‹ç®€ä»‹å“¦ğŸ˜"
            }
        }, content)
        Apollo.d.push({
            title: "ğŸ”¥ <a style='text-decoration: none;' href='" + lazy + "'>æ•…äº‹</a> ï¼š" + day_say.replace(/â€”/g, "")
                .slice(0, 23)
                .fontcolor("#FF0000")
                .small(),
            url: "hiker://empty",
            col_type: "rich_text",
            extra: {
                lineVisible: false,
                textSize: 16,
                lineSpacing: 3,
                id: "content_decid"
            }
        })
    },
    //äºŒçº§
    videoParse: (url) => {
        var yiji = $('#fypage#noHistory#')
            .rule(() => {
            const Apollo = $.require('hiker://page/Apollo')
            Apollo.avatarParse(MY_URL)
            setResult(Apollo.d)
        })
        const html = fetch(url, {
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0)'
            }
        })
        log(url)
        var title = MY_PARAMS.title;
        Apollo.d.push({
            title: 'â€œâ€œâ€â€' + Apollo.niutrans(title)
                .fontcolor("#E57A1A"),
            url: url,
            col_type: 'text_1',
            extra: {
                lineVisible: false,
                longClick: [{
                    title: 'ç½‘é¡µ',
                    js: $.toString(() => {
                        return "web://" + MY_URL
                    })
                }, {
                    title: 'ç™¾åº¦ç¿»è¯‘',
                    js: $.toString((title) => {
                        return "x5://https://fanyi.baidu.com/#jp/zh/" + title
                    }, title)
                }, {
                    title: 'Deeplç¿»è¯‘',
                    js: $.toString((title) => {
                        return "x5://https://www.deepl.com/zh/translator-mobile#ja/zh/" + title
                    }, title)
                }, {
                    title: 'è°·æ­Œç¿»è¯‘',
                    js: $.toString((title) => {
                        return "x5://https://translate.google.com/?hl=zh-CN&sl=ja&tl=zh-CN&text=" + title
                    }, title)
                }]
            }
        })
        const img = pdfh(html, "#video&&a&&href");
        const preview = pdfh(html, "body&&#ssdd+script&&Html")
        Apollo.d.push({
            img: img,
            url: preview.match(/src="(.*?)"/) ? preview.match(/src="(.*?)"/)[1] : "toast://æ²¡æœ‰é¢„è§ˆè§†é¢‘å“¦ğŸ˜",
            col_type: "pic_1_full",
        })
        Apollo.yiyanParse(html)
        const è¯†åˆ«ç  = pdfh(html, "body&&#td-Label&&button&&Text")
        Apollo.CodeParse(è¯†åˆ«ç )
        Apollo.d.push({
            title: 'â€œâ€œâ€â€' + "ç•ªå·ï¼š".fontcolor("#FF00FF") + è¯†åˆ«ç .toUpperCase()
                .fontcolor("#67E0FA"),
            url: "copy://" + è¯†åˆ«ç .toUpperCase(),
            col_type: "scroll_button",
        })
        //ç±»åˆ«
        try {
            var Genre = pdfh(html, 'body&&#th-Genre:matches(é¡åˆ¥)&&a&&Text');
            if (Genre) {
                Apollo.d.push({
                    title: 'â€˜â€˜â€™â€™<b><middle><font color="#1E90FF">' + Genre + '</font></middle></b>',
                    url: getHome(url) + pdfh(html, 'body&&#th-Genre:matches(é¡åˆ¥)&&a&&href') + yiji,
                    col_type: 'scroll_button',
                    extra: {
                        pageTitle: Genre
                    }
                })
            }
        } catch {}
        //å¯¼æ¼”
        try {
            var director = pdfh(html, 'body&&#td-Series&&a&&Text');
            if (director) {
                Apollo.d.push({
                    title: 'å¯¼æ¼”:â€˜â€˜â€™â€™<b><middle><font color="#1E90FF">\t\t' + director + '</font></middle></b>',
                    url: getHome(url) + pdfh(html, 'body&&#td-Series&&a&&href') + yiji,
                    col_type: 'scroll_button',
                    extra: {
                        pageTitle: director
                    }
                });
            }
        } catch {}

        Apollo.d.push({
            col_type: "blank_block",
        }, {
            title: pdfh(html, 'body&&#td-data&&Text') ? pdfh(html, 'body&&#td-data&&Text')
                .replace("æ—¶é—´", "") : "å‘å¸ƒ:N/A",
            url: Apollo.empty,
            col_type: "scroll_button",
        }, {
            title: pdfh(html, 'body&&#td-SkUmub&&Text') != "æ™‚é•·:" ? pdfh(html, 'body&&#td-SkUmub&&Text') : "æ™‚é•·:N/A",
            url: Apollo.empty,
            col_type: "scroll_button",
        })

        //ç‰‡å•†
        try {
            var makers = pdfh(html, 'body&&#td-Act&&a&&Text');
            if (makers) {
                Apollo.d.push({
                    title: 'ç‰‡å•†:â€˜â€˜â€™â€™<b><middle><font color="#1E90FF">\t' + makers + '</font></middle></b>',
                    url: getHome(url) + pdfh(html, 'body&&#td-Act&&a&&href') + yiji,
                    col_type: 'scroll_button',
                    extra: {
                        pageTitle: makers
                    }
                })
            }
        } catch {}

        //æ¼”å‘˜
        var arts = parseDomForArray(html, 'body&&#th-Genre:contains(æ¼”å“¡)&&a');
        if (arts.length > 0) {
            Apollo.d.push({
                col_type: "blank_block"
            })
            Apollo.d.push({
                title: "æ¼”å“¡:",
                url: 'hiker://empty',
                col_type: 'scroll_button',
            })
            for (var i in arts) {
                var title = parseDomForHtml(arts[i], 'Text');
                Apollo.d.push({
                    title: 'â€˜â€˜â€™â€™<b><middle><font color="#c13141">' + title + '</font></middle></b>',
                    url: getHome(url) + pdfh(arts[i], 'a&&href') + yiji,
                    col_type: 'scroll_button',
                    extra: {
                        pageTitle: title,
                        longClick: [{
                            title: 'å¤åˆ¶æ¼”å‘˜',
                            js: $.toString((title) => {
                                return "copy://" + title;
                            }, title)
                        }, {
                            title: 'è°·æ­Œæœç´¢',
                            js: $.toString((title) => {
                                return "https://www.google.com/search?q=" + title;
                            }, title)
                        }, {
                            title: 'ç™¾åº¦æœç´¢',
                            js: $.toString((title) => {
                                return "https://www.baidu.com/s?wd=" + title;
                            }, title)
                        }, {
                            title: 'ç£åŠ›æœæ¼”å‘˜',
                            js: $.toString((title) => {
                                return "hiker://page/sou?rule=ç£åŠ›å›.ç®€&p=fypage&searchTerms=" + title
                            }, title)
                        }]
                    }
                })
            }
        }

        //TAG
        var arts = parseDomForArray(html, 'body&&#th-Genre:contains(TAG)&&a');
        arts = arts.filter(t => pdfh(t, 'a&&Text')
            .trim() !== '');
        if (arts.length > 0) {
            Apollo.d.push({
                col_type: "blank_block"
            })
            Apollo.d.push({
                title: "TAG:",
                url: 'hiker://empty',
                col_type: 'scroll_button',
            });
            for (var i in arts) {
                Apollo.d.push({
                    title: 'â€˜â€˜â€™â€™<b><middle><font color="#1E8884">' + parseDomForHtml(arts[i], 'Text') + '</font></middle></b>',
                    url: getHome(url) + pdfh(arts[i], 'a&&href') + yiji,
                    col_type: 'scroll_button',
                    extra: {
                        pageTitle: parseDomForHtml(arts[i], 'Text')
                    }
                })
            }
        }

        Apollo.d.push({
            col_type: "blank_block"
        })
        try {
            var series = pdfh(html, 'body&&tr:contains(ç³»åˆ—)&&a&&Text');
            if (series) {
                Apollo.d.push({
                    title: 'ç³»åˆ—:â€˜â€˜â€™â€™<b><middle><font color="#1E90FF">\t' + series + '</font></middle></b>',
                    url: getHome(url) + pdfh(html, 'body&&tr:contains(ç³»åˆ—)&&a&&href') + yiji,
                    col_type: 'scroll_button',
                    extra: {
                        pageTitle: series
                    }
                })
            }
        } catch {}
        Apollo.d.push({
            col_type: "blank_block"
        })
        try {
            var picnum = pdfh(html, ".button2&&Text");
            if (picnum != "") {
                var list = pdfa(html, "#hiddenButton&&a")
                Apollo.d.push({
                    title: 'ğŸŒŒ\t\tâ€œâ€œâ€â€' + picnum.fontcolor("#FF00FF"),
                    url: Apollo.empty + $("")
                        .lazyRule((list) => {
                        try {
                            var pics = list.map(p => pdfh(p, "a&&href"))
                            if (pics.length !== 1) {
                                return "pics://" + pics.join("&&")
                            } else {
                                return pics[0]
                            }
                        } catch {
                            return "hiker://empty"
                        }
                    }, list),
                    col_type: "text_1",
                    extra: {
                        lineVisible: false
                    }
                })
            }
        } catch {}
        Apollo.CiliParse(html)
        Apollo.d.push({
            title: 'â€œâ€œâ€â€' + "æˆ‘æ˜¯æœ‰åº•çº¿çš„".fontcolor("grey")
                .small(),
            url: Apollo.empty,
            col_type: "text_center_1",
            extra: {
                lineVisible: false
            }
        })
        setResult(Apollo.d)
    },

    //ç£åŠ›åˆ—è¡¨
    CiliParse: (html) => {
        function magnetDecode(id) {
            let urlEncodedString = id;
            let encodedString = urlEncodedString.replace(/-/g, '+')
                .replace(/_/g, '/') + '=='.substring(0, (3 * urlEncodedString.length) % 4);
            let decodedString = window0.atob(encodedString);
            return decodedString
        }
        const magnet = pdfa(html, '#Magnet-cont&&tr,1:');
        magnet.forEach(item => {
            var url = magnetDecode(pdfh(item, "a&&id"));
            Apollo.d.push({
                title: pdfh(item, "a&&Text")
                    .replace(/\[(?:\[.*?\])?(.*?)\].*/, "$1"),
                desc: pdfh(item, "span&&Text") + "\t\t" + pdfh(item, "a&&Text")
                    .replace(/.*\[(\d+\.?(\d+)?(\s+)?(G|M|K)(\w+)?)\,?.*?\].*/i, "$1") + "\t\t" + pdfh(item, "a&&Text")
                    .replace(/.*\[(\d+-\d+-\d+).*?\].*/, "$1"),
                img: "https://img.vinua.cn/images/Ocqpj.png",
                url: url,
                col_type: "avatar",
                extra: {
                    lineVisible: false,
                    longClick: [{
                        title: 'Pikpak',
                        js: $.toString((url) => {
                            return "pikpakapp://mypikpak.com/xpan/main_tab?tab=1&add_url=" + url;
                        }, url)
                    }, {
                        title: 'å¹»å½±',
                        js: $.toString((url) => {
                            openAppIntent('com.xingsu.downloader', 'com.e4a.runtime.android.mainActivity', {
                                intentData: url
                            })
                            return "hiker://empty";
                        }, url)
                    }, {
                        title: 'å°ç™½',
                        js: $.toString((url) => {
                            openAppIntent('xb.download.com', 'io.dcloud.PandoraEntry', {
                                intentData: url
                            })
                            return "hiker://empty";
                        }, url)
                    }, {
                        title: 'è¿…é›·',
                        js: $.toString((url) => {
                            openAppIntent('com.xunlei.downloadprovider', 'com.xunlei.downloadprovider.launch.LaunchActivity2', {
                                intentData: url
                            })
                            return "hiker://empty";
                        }, url)
                    }, {
                        title: 'äºŒé©´',
                        js: $.toString((url) => {
                            openAppIntent('com.qikcloud.qik', 'com.e4a.runtime.android.mainActivity', {
                                intentData: url
                            })
                            return "hiker://empty";
                        }, url)
                    }, {
                        title: 'æ‚Ÿç©º',
                        js: $.toString((url) => {
                            openAppIntent('com.yfoo.wkDownloader', 'com.yfoo.wkDownloader.MainActivity', {
                                intentData: url
                            })
                            return "hiker://empty";
                        }, url)
                    }]
                }
            })
        })
    },

    // å¤–é“¾æ’­æ”¾
    CodeParse: (è¯†åˆ«ç ) => {
        Apollo.d.push({
            col_type: 'blank_block',
        })
        var codelazy = fetch('hiker://files/rules/apollo/CodeLazy.js')
            .replace(/d\.push/g, "Apollo.d.push") || "";

        function downcode() {
            var js = fetch("https://mirror.ghproxy.com/https://raw.githubusercontent.com/ApolloRioo/R/master/ApolloA");
            writeFile('hiker://files/rules/apollo/CodeLazy.js', js);
            toast("è¿œç¨‹æ•°æ®å·²æ›´æ–°åˆ°æœ¬åœ°")
            codelazy = fetch('hiker://files/rules/apollo/CodeLazy.js')
                .replace(/d\.push/g, "Apollo.d.push")
        }
        if (!codelazy) {
            downcode()
        }
        try {
            eval(codelazy)
        } catch {
            downcode()
            eval(codelazy)
            log("è¯»å–å¤±è´¥æ›´æ–°è¿œç¨‹æ•°æ®")
        }
        CodeLazy(è¯†åˆ«ç )
    }

}

$.exports = Apollo