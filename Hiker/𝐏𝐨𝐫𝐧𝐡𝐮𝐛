const Apollo = {
    version: "20250923",
    empty: "hiker://empty",
    url: "https://cn.pornhub.com",
    d: [],
    data: {
        category: getMyVar('Apo.category', '0'),
        subCate: getMyVar('Apo.subCate', '0'),
    },
    getRangeColors: function() {
        return '#' + ('00000' + (Math.random() * 0x1000000 << 0)
                .toString(16))
            .substr(-6);
    }, //éšæœºé¢œè‰²
    addPage: function(url, currentPage, lastPage) {
        if (url == "https://cn.pornhub.com/") {
            url = "https://cn.pornhub.com/video"
        }
        var jumpu = url.replace(/(\?page=\d+|\&page=\d+|$)/, (match) => {
            if (match.startsWith('?page=') || match.startsWith('&page=')) {
                return match.charAt(0) + 'page=' + "@@";
            } else {
                return (url.includes('?') ? '&page=' : '?page=') + "@@";
            }
        });
        //log(jumpu)
        var longClick = [{
            title: "é¦–é¡µ",
            js: $.toString((jumpu) => {
                putMyVar("url", jumpu.replace("@@", 1))
                putMyVar("yurl", jumpu.replace("@@", 1))
                refreshPage();
                return "hiker://empty";
            }, jumpu),
        }, {
            title: "ä¸Šé¡µ",
            js: $.toString((jumpu, currentPage) => {
                if (currentPage > 1) {
                    putMyVar("url", jumpu.replace("@@", currentPage - 1));
                    putMyVar("yurl", jumpu.replace("@@", currentPage - 1));
                    refreshPage();
                    return "hiker://empty";
                }
            }, jumpu, currentPage)
        }, {
            title: "ç¬¬" + currentPage + "é¡µ",
            js: ""
        }, {
            title: "è·³è½¬",
            js: $.toString((jumpu) => {
                return $("").input((jumpu) => {
                    putMyVar("url", jumpu.replace("@@", input))
                    putMyVar("yurl", jumpu.replace("@@", input))
                    refreshPage();
                }, jumpu);
            }, jumpu),
        }];
        if (typeof(lastPage) != "undefined") {
            var extra1 = {
                title: "å°¾é¡µ" + lastPage,
                js: $.toString((jumpu, lastPage) => {
                    putMyVar("url", jumpu.replace("@@", lastPage))
                    putMyVar("yurl", jumpu.replace("@@", lastPage))
                    refreshPage();
                    return "hiker://empty";
                }, jumpu, lastPage),
            };
            longClick.push(extra1)
        }
        return longClick
    }, //é•¿æŒ‰è·³é¡µ
    baseParse: () => {
        putMyVar("MY_TYPE", "ä¸»é¡µ");
        if (getVar("user")) {
            var userName = getVar("user")
            setItem("user", userName)
            //clearItem("user")
        }
        let categoryList = [{
            "title": "é¦–é¡µ",
            "path": "/",
            "type": "video",
            "sub": []
        }, {
            "title": "è§†é¢‘",
            "path": "",
            "type": "video",
            "sub": [{
                "title": "è‰²æƒ…ç‰‡",
                "path": "/video"
            }, {
                "title": "ğŸ‡¨ğŸ‡³ä¸­æ–‡",
                "path": "/language/chinese"
            }, {
                "title": "ğŸ‡®ğŸ‡¹æ„å¤§åˆ©",
                "path": "/language/italian"
            }, {
                "title": "ğŸ‡©ğŸ‡ªå¾·å›½",
                "path": "/language/german"
            }, {
                "title": "ğŸ‡¨ğŸ‡¿æ·å…‹",
                "path": "/language/czech"
            }, {
                "title": "ğŸ‡«ğŸ‡·æ³•å›½",
                "path": "/language/french"
            }, {
                "title": "ğŸ‡·ğŸ‡ºä¿„ç½—æ–¯",
                "path": "/language/russian"
            }, {
                "title": "ğŸ‡¯ğŸ‡µæ—¥æœ¬",
                "path": "/language/japanese"
            }, {
                "title": "ğŸ‡ªğŸ‡¸è¥¿ç­ç‰™",
                "path": "/language/spanish"
            }, {
                "title": "ğŸ‡³ğŸ‡±è·å…°",
                "path": "/language/dutch"
            }, {
                "title": "ğŸ‡µğŸ‡±æ³¢å…°",
                "path": "/language/polish"
            }, {
                "title": "ğŸ‡µğŸ‡¹è‘¡è„ç‰™",
                "path": "/language/portuguese"
            }]
        }, {
            "title": "æˆ‘çš„",
            "path": "",
            "type": "login",
            "sub": [{
                "title": "ğŸ‘ç‚¹èµ",
                "path": "/likedvideos"
            }, {
                "title": "ğŸ’æœ€çˆ±",
                "path": "/users/" + getItem("user", "") + "/videos/favorites"
            }, {
                "title": "ğŸ’½ç‰‡å•",
                "path": "/users/" + getItem("user", "") + "/playlists/private"
            }, {
                "title": "ğŸ‘¤è®¢é˜…",
                "path": "/users/" + getItem("user", "") + "/subscriptions"
            }, {
                "title": "ğŸ˜ˆç™»å½•",
                "path": "/login"
            }]
        }, {
            "title": "åˆ†ç±»",
            "path": "/categories",
            "type": "category",
            "sub": []
        }, {
            "title": "æ˜æ˜Ÿ",
            "path": "",
            "type": "pornstar",
            "sub": [{
                "title": "æ¨¡ç‰¹",
                "path": "/pornstars"
            }, {
                "title": "å·²è®¤è¯ç´ äºº",
                "path": "/pornstars?performerType=amateur"
            }, {
                "title": "è‰²æƒ…æ˜æ˜Ÿ",
                "path": "/pornstars?performerType=pornstar"
            }, {
                "title": "ç”·æ¼”å‘˜",
                "path": "/pornstars?gender=male"
            }]
        }, {
            "title": "é¢‘é“",
            "path": "/channels",
            "type": "channel",
            "sub": []
        }, {
            "title": "ç‰‡å•",
            "path": "/playlists",
            "type": "playlist",
            "sub": []
        }]
        const currentCate = categoryList[Apollo.data.category]
        let url
        let type = currentCate.type
        let path = currentCate.path
        if (currentCate.sub.length > 0) {
            url = Apollo.url + getMyVar("url", currentCate.sub[Apollo.data.subCate].path)
            path = currentCate.sub[Apollo.data.subCate].path
        } else {
            url = Apollo.url + getMyVar("url", currentCate.path)
        }
        url = url.replace(/https?.*(https?.*)/, "$1")
        if (MY_PAGE === 1) {
            categoryList.forEach((cate, index) => {
                Apollo.d.push({
                    title: parseInt(Apollo.data.category) === index ? 'â€œâ€œâ€â€' + cate.title.fontcolor("#FFFFFF").bold() : cate.title,
                    url: $(Apollo.empty + "#noLoading#")
                        .lazyRule((index) => {
                            putMyVar("Apo.category", index.toString())
                            putMyVar("Apo.subCate", '0')
                            clearMyVar("url")
                            clearMyVar("sort")
                            clearMyVar("yurl")
                            clearMyVar("ysort")
                            refreshPage(true)
                            return "hiker://empty"
                        }, index),
                    col_type: 'scroll_button',
                    extra: {
                        'backgroundColor': parseInt(Apollo.data.category) === index ? Apollo.getRangeColors() : ''
                    }
                })
                /*ç‰¹ä¾‹ï¼Œåˆ†å‰²ç¬¬ä¸€è¡Œé¡¶éƒ¨
                if (index == 3) {
                    Apollo.d.push({
                        col_type: 'blank_block',
                    })
                } */ //åˆ†å‰²è¡Œ
            })
            if (currentCate.sub.length > 0) {
                Apollo.d.push({
                    col_type: 'blank_block',
                })
                currentCate.sub.forEach((cate, index) => {
                    Apollo.d.push({
                        title: parseInt(Apollo.data.subCate) === index ? 'â€œâ€œâ€â€' + cate.title.fontcolor("#FFFFFF").bold() : cate.title,
                        url: $(Apollo.empty + "#noLoading#")
                            .lazyRule((index) => {
                                putMyVar("Apo.subCate", index.toString())
                                clearMyVar("url")
                                clearMyVar("sort")
                                clearMyVar("yurl")
                                clearMyVar("ysort")
                                refreshPage(true)
                                return "hiker://empty"
                            }, index),
                        col_type: 'scroll_button',
                        extra: {
                            'backgroundColor': parseInt(Apollo.data.subCate) === index ? Apollo.getRangeColors() : ''
                        }
                    })
                })
            }
        }

        //ç¿»é¡µ
        let nextPage = getMyVar("nextPage", "");
        if (nextPage && MY_PAGE > 1) {
            if (url.includes("random")) {
                url = url
            } else {
                url = nextPage;
            };
        } else if (MY_PAGE > 1) {
            url = "æ²¡æœ‰ä¸‹ä¸€é¡µå“¦ğŸ˜‘"
        }

        var html = fetch(url, {
            headers: {
                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
            }
        })
        log(url);
        try {
            var next = Apollo.url + pdfh(html, "body&&.pagination&&.page_next&&a&&href")
            next = next.replace(/https?.*(https?.*)/, "$1")
            putMyVar("nextPage", next);
        } catch {
            clearMyVar("nextPage");
            //log("å¯èƒ½ä¸å­˜åœ¨ä¸‹ä¸€é¡µæˆ–è€…ä¸‹ä¸€é¡µå®šä½æœ‰é—®é¢˜");
        }

        Apollo.videoSort(html)
        //æœç´¢
        if (MY_PAGE == 1 && !/category/.test(url)) {
            Apollo.d.push({
                title: "ğŸ”",
                url: $.toString((url) => {
                    if (input.trim() != "") {
                        if (input.includes("view_video.php")) {
                            return input + $('')
                                .rule(() => {
                                    const Apollo = $.require('hiker://page/Apollo')
                                    Apollo.videoParse(MY_URL)
                                    setResult(Apollo.d)
                                })
                        } else if (input.includes("pornhub.com")) {
                            return "hiker://empty#" + input + $('/videos##fypage')
                                .rule(() => {
                                    const Apollo = $.require('hiker://page/Apollo')
                                    Apollo.yijiParse(MY_URL.split("##")[0])
                                    setResult(Apollo.d)
                                })
                        } else {
                            putMyVar('keyword', input);
                            var searchUrl = getHome(url) + "/video/search?search=" + input
                            putMyVar("url", searchUrl);
                            refreshPage();
                            return "hiker://empty"
                        }
                    } else {
                        putMyVar('keyword', input);
                        var searchUrl = "https://cn.pornhub.com/"
                        putMyVar("url", searchUrl);
                        refreshPage();
                        return "toast://æœç´¢å†…å®¹ä¸ºç©º"
                    }
                }, url),
                desc: 'æœç´¢...',
                col_type: "input",
                extra: {
                    defaultValue: getMyVar('keyword', '') || "",
                }
            });
        }
        if (MY_PAGE == 1 && url.includes("search")) {
            Apollo.d.push({
                title: 'â€œâ€œâ€â€' + "æœå¯»ç»“æœ".fontcolor("#FF00FF"),
                url: "hiker://empty",
                col_type: "text_1",
                extra: {
                    lineVisible: false
                }
            })
        }
        switch (type) {
            case 'video':
                Apollo.videoType(url, html)
                break
            case 'category':
                if (url.includes("search")) {
                    Apollo.videoType(url, html)
                } else {
                    if (MY_PAGE == 1) {
                        Apollo.categoryType(html)
                    }
                }
                break
            case 'pornstar':
                if (url.includes("search")) {
                    Apollo.videoType(url, html)
                } else {
                    Apollo.pornstarType(url, html)
                }
                break
            case 'channel':
                if (url.includes("search")) {
                    Apollo.videoType(url, html)
                } else {
                    Apollo.channelType(url, html)
                }
                break
            case 'playlist':
                if (url.includes("search")) {
                    Apollo.videoType(url, html)
                } else {
                    Apollo.playlistType(url, html)
                }
                break
            case 'login':
                if (url.includes("playlists")) {
                    Apollo.playlistType(url, html)
                } else if (url.includes("login")) {
                    Apollo.loginType(html)
                } else if (url.includes("pornstar_subscriptions")) {
                    Apollo.pornstarType(url, html)
                } else if (url.includes("channel_subscriptions")) {
                    Apollo.channelType(url, html);
                } else if (url.includes("subscriptions")) {
                    Apollo.pornstarType(url, html);
                } else {
                    Apollo.videoType(url, html)
                }
                break
            default:
                Apollo.videoType(url, html)
        }
        setResult(Apollo.d)
    },
    //ç™»å½•
    loginType: (html) => {
        if (html.includes("Log Out")) {
            Apollo.d.push({
                title: 'â€œâ€œâ€â€<big><font color=#118811>è´¦å·å·²ç™»å½•,ç‚¹å‡»é€€å‡ºè´¦å·</font></big>',
                desc: 'â€œâ€œâ€â€' + 'åˆ‡æ¢åˆ†ç±»åˆ·æ–°é¡µé¢å†…å®¹'.fontcolor('#FF0000').big(),
                url: 'hiker://empty' + $('').lazyRule(() => {
                    writeFile('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt', '');
                    const Apollo = $.require('hiker://page/Apollo')
                    fetch(Apollo.url + "/ja/logout.php", {
                        headers: {
                            cookie: fetchPC('hiker://files/rules/Apollo/Cookie/javland_cookie.txt') || '',
                            "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
                        }
                    })
                    refreshPage();
                    return "toast://è´¦å·å·²ç™»å‡º";
                }),
                col_type: 'text_center_1',
                extra: {
                    lineVisible: false
                }
            });
        } else {
            Apollo.d.push({
                title: 'â€œâ€œâ€â€' + 'ç‚¹å‡»ç™»å½•è´¦å·'.fontcolor('#FF00FF').big(),
                url: Apollo.url + "/login" + $('').rule(() => {
                    var d = [];
                    d.push({
                        col_type: 'x5_webview_single',
                        url: MY_URL,
                        desc: 'list&&screen',
                        extra: {
                            lineVisible: false,
                            "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36", //PC_UA,             
                            showProgress: false,
                            js: $.toString((u) => {
                                function check() {
                                    let nodes = document.querySelectorAll('.videoList', 'li[data-video-id]');
                                    let userNameElement = document.querySelector('.js_userName');
                                    let userNameText = userNameElement ? userNameElement.textContent.trim() : null;
                                    //fba.putVar("user", userNameText)
                                    //fba.log(userNameText)
                                    // var ua = fba.getUa()
                                    //  fba.log('co::::::' + ua);
                                    //var htmlContent = document.documentElement.innerHTML;

                                    //if (/åŸºæœ¬æƒ…å ±/.test(htmlContent)) {
                                    var co = fba.getCookie(u);
                                    fba.log('co::::::' + co);
                                    if (nodes && nodes.length > 0 && co && userNameText) {
                                        fba.parseLazyRule($$$().lazyRule((co, userNameText) => {
                                            writeFile('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt', co);
                                            putVar("user", userNameText)
                                            toast('è´¦å·å·²ç™»å½•');
                                            back(true);
                                        }, co, userNameText));
                                    } else {
                                        setTimeout(check, 500);
                                    }
                                }
                                check();
                            }, MY_URL)
                        }
                    });
                    return setResult(d);
                }),
                col_type: 'text_center_1'
            });

        }
    },

    //ä¸€çº§sort
    videoSort: (html) => {
        if (MY_PAGE == 1) {
            Apollo.d.push({
                col_type: "blank_block",
            });
            try {
                var sort = pdfa(html, 'body&&.subFilterList:not(.hidden)&&a:not(:matches(æˆå°±|è®¢é˜…))')
                sort.forEach((item, index) => {
                    var title = pdfh(item, 'Text');
                    var urll = Apollo.url + pdfh(item, 'a&&href');
                    urll = urll.replace(/https?.*(https?.*)/, "$1");
                    Apollo.d.push({
                        title: title,
                        url: urll + $('#noLoading#')
                            .lazyRule((index) => {
                                if (getMyVar("MY_TYPE") == "ä¸»é¡µ") {
                                    putMyVar('sort', index);
                                    putMyVar("url", input);
                                } else {
                                    putMyVar('ysort', index);
                                    putMyVar("yurl", input);
                                }
                                refreshPage();
                                return 'hiker://empty'
                            }, index),
                        col_type: 'scroll_button',
                        extra: {
                            'backgroundColor': (getMyVar("MY_TYPE") == "ä¸»é¡µ" ? getMyVar('sort', '0') == index : getMyVar('ysort', '0') == index) ? Apollo.getRangeColors() : ''
                        }
                    })
                })
            } catch {}
        }
    },

    //åŠ¨æ€åˆ†ç±»
    DynamicSort: (url, html) => {
        const åˆ†ç±»é¢œè‰² = Apollo.getRangeColors()
        const å¤§ç±»å®šä½ = 'body&&.origin-top-right.w-56.z-10'
        const æ‹¼æ¥åˆ†ç±» = ''
        const å°ç±»å®šä½ = 'body&&a'
        const åˆ†ç±»æ ‡é¢˜ = 'Text'
        const åˆ†ç±»é“¾æ¥ = 'a&&href'
        Apollo.d.push({
            col_type: "blank_block"
        });
        try {
            if (typeof(æ‹¼æ¥åˆ†ç±») != 'undefined' && æ‹¼æ¥åˆ†ç±» != '') {
                var categories = pdfa(html, å¤§ç±»å®šä½).concat(pdfa(html, æ‹¼æ¥åˆ†ç±»))
            } else {
                var categories = pdfa(html, å¤§ç±»å®šä½)
            }
        } catch {
            var categories = pdfa(html, å¤§ç±»å®šä½)
        }
        let init_cate = []
        for (let i = 0; i < 20; i++) {
            init_cate.push("0")
        }
        if (url.includes("search")) {
            var cate_temp_json = getMyVar("ysort", JSON.stringify(init_cate))
        } else {
            var cate_temp_json = getMyVar("sort", JSON.stringify(init_cate))
        }
        var cate_temp = JSON.parse(cate_temp_json)

        if (MY_PAGE == 1) {
            categories.forEach((category, index) => {
                let sub_categories = pdfa(category, å°ç±»å®šä½);
                sub_categories.forEach((item, key) => {
                    let title = pdfh(item, åˆ†ç±»æ ‡é¢˜)
                    if (typeof(æ’é™¤) != 'undefined' && æ’é™¤ != '') {
                        title = title.replace(new RegExp(æ’é™¤, "g"), "")
                    };
                    Apollo.d.push({
                        title: key.toString() === cate_temp[index] ? 'â€œâ€œâ€â€' + title.fontcolor(åˆ†ç±»é¢œè‰²) : title,
                        url: $(pdfh(item, åˆ†ç±»é“¾æ¥) + '#noLoading#').lazyRule((params) => {
                            params.cate_temp[params.index] = params.key.toString()
                            if (getMyVar("MY_TYPE") == "ä¸»é¡µ") {
                                putMyVar('sort', JSON.stringify(params.cate_temp));
                                putMyVar("url", input);
                            } else {
                                putMyVar('ysort', JSON.stringify(params.cate_temp));
                                putMyVar("yurl", input);
                            }
                            refreshPage(true)
                            return "hiker://empty"
                        }, {
                            cate_temp: cate_temp,
                            index: index,
                            key: key,
                            page: MY_PAGE,
                        }),
                        col_type: 'scroll_button',
                        extra: {
                            'backgroundColor': key.toString() === cate_temp[index] ? Apollo.getRangeColors() : ''
                        }
                    })
                })
                Apollo.d.push({
                    col_type: "blank_block"
                });
            })
        }
    },

    //ä¸€çº§è§†é¢‘åˆ—è¡¨
    videoType: (url, html) => {
        try {
            var currentPage = pdfh(html, "body&&.pagination&&.page_current&&Text").match(/\d+/)[0]
        } catch {
            var currentPage = "1"
        }
        var list = pdfa(html, "body&&li[data-video-id]:has(a)");
        list.forEach(item => {
            var vurl = Apollo.url + pdfh(item, 'a&&href');
            vurl = vurl.replace(/https?.*(https?.*)/, "$1")
            var title = pdfh(item, ".title&&Text");
            var img = pdfh(item, "img&&src");
            Apollo.d.push({
                title: title,
                desc: pdfh(item, ".views&&Text") + "â°" + pdfh(item, ".time&&Text"),
                img: img ? img : "https://thumbsnap.com/i/3uqjc1qq.gif",
                url: vurl + $('#noHistory#')
                    .rule(() => {
                        const Apollo = $.require('hiker://page/Apollo')
                        Apollo.videoParse(MY_URL)
                        setResult(Apollo.d)
                    }),
                col_type: "movie_2",
                extra: {
                    pageTitle: title,
                    longClick: !url.includes("viewkey") ? Apollo.addPage(url, currentPage) : ""
                }
            })
        })
    },
    //ç±»åˆ«
    categoryType: (html) => {
        var tabs = pdfa(html, 'body&&.categoriesTitle'); //å¤§ç±»
        var conts = pdfa(html, 'body&&.categoriesWrapper'); //å°ç±»

        for (var i = 0; i < conts.length; i++) {
            var list = pdfa(conts[i], 'body&&.catPic');
            Apollo.d.push({
                title: pdfh(tabs[i], 'Text').bold(),
                url: 'toast://ç‚¹äº†ä¹Ÿæ²¡ç”¨',
                col_type: "rich_text"
            });
            /*
                d.push({
                    col_type: "line"
                });
            */
            list.forEach(item => {
                var vurl = Apollo.url + pdfh(item, 'a&&href');
                vurl = vurl.replace(/https?.*(https?.*)/, "$1")
                Apollo.d.push({
                    title: pdfh(item, "strong&&Text"),
                    desc: pdfh(item, ".videoCount&&Text"),
                    img: pd(item, "img&&src") ? pd(item, "img&&src") : "https://thumbsnap.com/i/3uqjc1qq.gif",
                    url: "hiker://empty#" + vurl + $('##fypage')
                        .rule(() => {
                            const Apollo = $.require('hiker://page/Apollo')
                            Apollo.yijiParse(MY_URL.split("##")[0])
                            setResult(Apollo.d)
                        }),
                    col_type: "movie_2",
                })
            })
        }
    },

    //æ˜æ˜Ÿ
    pornstarType: (url, html) => {
        try {
            var currentPage = pdfh(html, "body&&.pagination&&.page_current&&Text").match(/\d+/)[0]
        } catch {
            var currentPage = "1"
        }
        var list = pdfa(html, "body&&.pornstarList:not(.topPornstars)||.bigThumbList&&li");
        list.forEach(item => {
            var title = pdfh(item, ".performerCardName||.usernameLink&&Text") +
                "\nNo." + pdfh(item, ".rank_number&&Text") + "ğŸ–¥" + pdfh(item, ".videos&&Text");
            var vurl = Apollo.url + pdfh(item, 'a&&href');
            vurl = vurl.replace(/https?.*(https?.*)/, "$1")
            Apollo.d.push({
                title: title,
                img: pdfh(item, "img&&src") ? pdfh(item, "img&&src") : "https://thumbsnap.com/i/3uqjc1qq.gif",
                url: "hiker://empty#" + vurl + $('/videos##fypage')
                    .rule(() => {
                        const Apollo = $.require('hiker://page/Apollo')
                        Apollo.yijiParse(MY_URL.split("##")[0])
                        setResult(Apollo.d)
                    }),
                col_type: "card_pic_3",
                extra: {
                    pageTitle: title,
                    longClick: !url.includes("viewkey") ? Apollo.addPage(url, currentPage) : ""
                }
            })
        })
    },
    //é¢‘é“
    channelType: (url, html) => {
        if (MY_PAGE == 1) {
            Apollo.d.push({
                col_type: "blank_block",
            });
            var sort = pdfa(html, '.display-none&&li')
            sort.forEach((item, index) => {
                var title = pdfh(item, 'Text');
                var urll = Apollo.url + pdfh(item, 'li&&data-value');
                urll = urll.replace(/https?.*(https?.*)/, "$1");
                Apollo.d.push({
                    title: title,
                    url: urll + $('#noLoading#')
                        .lazyRule((index) => {
                            putMyVar('csort', index);
                            putMyVar("url", input);
                            refreshPage();
                            return 'hiker://empty'
                        }, index),
                    col_type: 'scroll_button',
                    extra: {
                        'backgroundColor': getMyVar('csort', '1') == index ? Apollo.getRangeColors() : ''
                    }
                })
            })
        }
        try {
            var currentPage = pdfh(html, "body&&.pagination&&.page_current&&Text").match(/\d+/)[0]
        } catch {
            var currentPage = "1"
        }
        var list = pdfa(html, "body&&.positionRelative||.channelSubChannelWig");
        list.forEach(item => {
            var title = pdfh(item, ".channelNameWrapper||.wtitle&&Text").slice(0, 12) + "\nğŸ–¥" + pdfh(item, ".info:matches(è§†é¢‘)||.rank&&Text");
            var vurl = Apollo.url + pdfh(item, 'a&&href');
            vurl = vurl.replace(/https?.*(https?.*)/, "$1")
            Apollo.d.push({
                title: title,
                img: pdfh(item, "img&&src") ? pdfh(item, "img&&src") : "https://thumbsnap.com/i/3uqjc1qq.gif",
                url: "hiker://empty#" + vurl + $('/videos##fypage')
                    .rule(() => {
                        const Apollo = $.require('hiker://page/Apollo')
                        Apollo.yijiParse(MY_URL.split("##")[0])
                        setResult(Apollo.d)
                    }),
                col_type: "card_pic_3",
                extra: {
                    pageTitle: title,
                    longClick: !url.includes("viewkey") ? Apollo.addPage(url, currentPage) : ""
                }
            })
        })
    },
    //ç‰‡å•
    playlistType: (url, html) => {
        try {
            var currentPage = pdfh(html, "body&&.pagination&&.page_current&&Text").match(/\d+/)[0]
        } catch {
            var currentPage = "1"
        }
        var list = pdfa(html, "body&&.playlistWrapper");
        list.forEach(item => {
            var title = pdfh(item, ".title&&Text");
            var vurl = Apollo.url + pdfh(item, '.title&&a&&href');
            vurl = vurl.replace(/https?.*(https?.*)/, "$1")
            Apollo.d.push({
                title: title,
                desc: "ğŸ–¥" + pdfh(item, ".thumbCorners&&Text"),
                img: pdfh(item, "img&&src") ? pdfh(item, "img&&src") : "https://thumbsnap.com/i/3uqjc1qq.gif",
                url: "hiker://empty#" + vurl + $('##fypage')
                    .rule(() => {
                        const Apollo = $.require('hiker://page/Apollo')
                        Apollo.yijiParse(MY_URL.split("##")[0])
                        setResult(Apollo.d)
                    }),
                col_type: "movie_2",
                extra: {
                    pageTitle: title,
                    longClick: !url.includes("viewkey") ? Apollo.addPage(url, currentPage) : ""
                }
            })
        })
    },

    //ä¸€çº§.ç®€
    yijiParse: (url) => {
        putMyVar("MY_TYPE", "ä¸€çº§")
        addListener("onClose", $.toString(() => {
            clearMyVar("yurl");
            clearMyVar("ysort");
        }));
        url = getMyVar("yurl", url)
        //ç¿»é¡µ
        let nextPage = getMyVar("YnextPage", "");
        if (nextPage && MY_PAGE > 1) {
            if (url.includes("random")) {
                url = url
            } else {
                url = nextPage;
            };
        } else if (MY_PAGE > 1) {
            url = "æ²¡æœ‰ä¸‹ä¸€é¡µå“¦ğŸ˜‘"
        }
        url = url.replace("hiker://empty#", "")
        var code = JSON.parse(fetch(url, {
            onlyHeaders: true
        })).statusCode.toString()
        if (!code.startsWith("2")) {
            url = url.replace(/\/videos$/, "")
        }
        var html = fetch(url, {
            headers: {
                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
            }
        })
        log(url)
        try {
            var next = Apollo.url + pdfh(html, "body&&.pagination&&.page_next&&a&&href")
            next = next.replace(/https?.*(https?.*)/, "$1")
            putMyVar("YnextPage", next);
        } catch {
            if (url.includes("/playlist/")) {
                let pageParam = url.match(/page=(\d+)/);
                let currentPage = pageParam ? parseInt(pageParam[1], 10) : 1;
                let newPageValue = currentPage + 1;
                var lazyloadUrl;
                try {
                    lazyloadUrl = JSON.parse(html.match(/var PLAYLIST_VIEW =\s?(.+);\n/)[1]).lazyloadUrl
                    putMyVar("lazyloadUrl", lazyloadUrl)
                } catch {}
                next = Apollo.url + getMyVar("lazyloadUrl") + "&page=" + newPageValue
                putMyVar("YnextPage", next);
            } else {
                clearMyVar("YnextPage");
                //log("å¯èƒ½ä¸å­˜åœ¨ä¸‹ä¸€é¡µæˆ–è€…ä¸‹ä¸€é¡µå®šä½æœ‰é—®é¢˜");
            }
        }
        if (MY_PAGE == 1) {
            try {
                if (pdfa(html, "body&&#channelsProfile&&.cover").length > 0) {
                    var cover = pdfh(html, "body&&#channelsProfile&&.cover&&img&&src");
                    var title = "â€œâ€œâ€â€" + pdfh(html, "body&&#channelsProfile&&h1&&Text").fontcolor("#666666").bold().big() + "\n" + pdfh(html, "body&&#channelsProfile&&.subscribeButton&&Text").fontcolor("#86bac8").bold().big();
                    var desc = "â€œâ€œâ€â€" + pdfh(html, "body&&#channelsProfile&&.channelStats&&li&&Text").fontcolor("#666666").bold() + "\t\t" + pdfh(html, "body&&#channelsProfile&&.channelStats&&li:nth-child(2)&&Text").fontcolor("#666666").bold() + "\n\n" + pdfh(html, "body&&#channelsProfile&&.channelStats&&li:nth-child(3)&&Text").fontcolor("#666666").bold() + "\t\t" + pdfh(html, "body&&#channelsProfile&&.channelStats&&li:nth-child(4)&&Text").fontcolor("#666666").bold();
                    var img = pdfh(html, "body&&#channelsProfile&&.avatar&&img&&src");
                } else {
                    var cover = pdfh(html, "#communityProfileWrapper&&.imageWrapper&&img&&src");
                    var title = "â€œâ€œâ€â€" + pdfh(html, "#communityProfileWrapper&&h1&&Text").fontcolor("#666666").bold().big() + "\n" + pdfh(html, "#communityProfileWrapper&&.subscribeButton&&Text").fontcolor("#86bac8").bold().big();
                    var desc = "â€œâ€œâ€â€" + pdfh(html, "#communityProfileWrapper&&.rankInfo&&Text").fontcolor("#666666").bold() + "\t\t" + pdfh(html, "#communityProfileWrapper&&.rankInfo:nth-child(3)&&Text").fontcolor("#666666").bold() + "\n\n" + pdfh(html, "#communityProfileWrapper&&.rankInfo:nth-child(2)&&Text").fontcolor("#666666").bold();
                    var img = pdfh(html, "#communityProfileWrapper&&#getAvatar&&img&&src");
                }
                if (title.includes("å·²è®¢é˜…")) {
                    var url = Apollo.url + pdfh(html, ".subscribeButton&&button&&data-unsubscribe-url")
                } else {
                    var url = Apollo.url + pdfh(html, ".subscribeButton&&button&&data-subscribe-url")
                }
                Apollo.d.push({
                    img: cover,
                    url: "hiker://empty",
                    col_type: "pic_1_full"
                }, {
                    title: title,
                    desc: desc,
                    img: img,
                    url: url + $("").lazyRule(() => {
                        try {
                            var html = post(input, {
                                headers: {
                                    "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                                    "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
                                }
                            })
                            message = JSON.parse(html).message
                            refreshPage()
                            return "toast://" + message
                        } catch {
                            return "toast://ç½‘ç»œé”™è¯¯ï¼Œè¯·æ±‚å¤±è´¥"
                        }
                    }),
                    col_type: "movie_1_vertical_pic"
                })
            } catch {}
        }
        Apollo.videoSort(html)
        Apollo.videoType(url, html)
        setResult(Apollo.d)
    },
    //äºŒçº§
    videoParse: (url) => {
        log(url)
        var html = fetch(url, {
            headers: {
                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
            },
        });
        //æ ‡é¢˜
        var title = pdfh(html, "body&&h1&&Text");
        Apollo.d.push({
            title: 'â€œâ€œâ€â€' + title.fontcolor("").small(),
            url: url,
            col_type: 'text_1',
            extra: {
                lineVisible: false,
                id: 'transdesc',
                longClick: [{
                    title: 'ç½‘é¡µ',
                    js: $.toString(() => {
                        return "web://" + MY_URL
                    })
                }, {
                    title: 'å¤åˆ¶',
                    js: $.toString((title) => {
                        return "copy://" + title;
                    }, title)
                }]
            }
        })

        // è¿™ä¸ªå˜é‡å®šä¹‰åœ¨ä¸‹é¢æ‰§è¡Œ script çš„ä¸Šæ–¹ï¼Œæ²¡æœ‰è¢«è¯»å–æ‰§è¡Œï¼Œéœ€è¦æ‰‹åŠ¨å£°æ˜é¿å…æŠ¥é”™
        let playerObjList = {}
        // è·å–è§†é¢‘æ’­æ”¾åœ°å€çš„å˜é‡å¹¶æ‰§è¡Œ
        var js = parseDomForHtml(html, "[id=mobileContainer]&&script&&Html").replace(/var flashvars_.*?=/, 'var flashvars =');
        eval(js);
        var list = flashvars.mediaDefinitions
        JSON.stringify(list.sort(function(a, b) {
            return b.quality - a.quality
        }));
        var urls = []
        var names = []
        list.forEach(item => {
            if (typeof item.quality === 'string') {
                urls.push(
                    item.videoUrl,
                );
                names.push(
                    item.quality,
                );
            }
        })
        var playlist = JSON.stringify({
            urls,
            names
        })
        var img = parseDom(html, "link[as=image]&&href");
        Apollo.d.push({
            img: img,
            url: playlist,
            col_type: "pic_1_full",
        })

        var è¯¦ç»†ä¿¡æ¯ = pdfh(html, "body&&.ratingDetails&&Text").trim();
        if (è¯¦ç»†ä¿¡æ¯ != "") {
            Apollo.d.push({
                title: è¯¦ç»†ä¿¡æ¯.fontcolor("#666666").bold(),
                col_type: "rich_text"
            })
            Apollo.d.push({
                col_type: "line",
            })
        }
        try {
            var show = html.match(/var VIDEO_SHOW[^\n]+/)[0]
            eval(show)
            Apollo.d.push({
                title: "ğŸ‘ğŸ»èµğŸ‘ğŸ»",
                url: Apollo.url + VIDEO_SHOW.voteUrl + "&value=1" + $("").lazyRule(() => {
                    try {
                        var html = post(input, {
                            headers: {
                                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
                            }
                        })
                        //refreshPage()
                        return "toast://ç‚¹èµæˆåŠŸ"
                    } catch {
                        return "toast://ç½‘ç»œé”™è¯¯ï¼Œè¯·æ±‚å¤±è´¥"
                    }
                }),
                col_type: "text_5"
            })
            Apollo.d.push({
                title: "ğŸ‘ğŸ» ğŸ‘ğŸ»",
                url: Apollo.url + "/likedvideos/delete?video_id=" + VIDEO_SHOW.videoId + $("").lazyRule(() => {
                    try {
                        var html = fetch(input, {
                            headers: {
                                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
                            }
                        })
                        //refreshPage()
                        return "toast://å·²æˆåŠŸå–æ¶ˆç‚¹èµ"
                    } catch {
                        return "toast://ç½‘ç»œé”™è¯¯ï¼Œè¯·æ±‚å¤±è´¥"
                    }
                }),
                col_type: "text_5"
            })
            Apollo.d.push({
                title: "ğŸ’–çˆ±ğŸ’–",
                url: Apollo.url + VIDEO_SHOW.favoriteUrl + "##" + VIDEO_SHOW.videoId + "##" + VIDEO_SHOW.token + $("").lazyRule(() => {
                    try {
                        data = input.split("##")
                        var html = post(data[0], {
                            headers: {
                                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
                            },
                            body: {
                                toggle: 1,
                                id: data[1],
                                token: data[2]
                            }
                        })
                        //refreshPage()
                        return "toast://æ”¶è—æˆåŠŸ"
                    } catch {
                        return "toast://ç½‘ç»œé”™è¯¯ï¼Œè¯·æ±‚å¤±è´¥"
                    }
                }),
                col_type: "text_5"
            })
            Apollo.d.push({
                title: "ğŸ–¤ğŸ¤",
                url: Apollo.url + VIDEO_SHOW.favoriteUrl + "##" + VIDEO_SHOW.videoId + "##" + VIDEO_SHOW.token + $("").lazyRule(() => {
                    try {
                        data = input.split("##")
                        var html = post(data[0], {
                            headers: {
                                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
                            },
                            body: {
                                toggle: 0,
                                id: data[1],
                                token: data[2]
                            }
                        })
                        //refreshPage()
                        return "toast://å–æ¶ˆæ”¶è—æˆåŠŸ"
                    } catch {
                        return "toast://ç½‘ç»œé”™è¯¯ï¼Œè¯·æ±‚å¤±è´¥"
                    }
                }),
                col_type: "text_5"
            })
            //ç‰‡å•
            var videolist = [{
                "title": "ç¨åè§‚çœ‹",
                "url": "https://cn.pornhub.com/api/v1/playlist/video_add_watchlater",
                pid: "",
                vid: VIDEO_SHOW.videoId,
                token: VIDEO_SHOW.token
            }]
            VIDEO_SHOW.byTitleAsc.forEach(item => {
                videolist.push({
                    title: item.title,
                    url: "https://cn.pornhub.com/api/v1/playlist/video",
                    pid: item.id,
                    vid: VIDEO_SHOW.videoId,
                    token: VIDEO_SHOW.token
                })
            })
            var tit = videolist.map(i => i.title)
            Apollo.d.push({
                title: "â€œâ€œâ€â€" + "æ·»åŠ è‡³".fontcolor("#FF00FF"),
                url: $(tit, 2).select((videolist) => {
                    let index = videolist.findIndex(r => r.title == input);
                    try {
                        var html = post(videolist[index].url, {
                            headers: {
                                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
                            },
                            body: {
                                pid: videolist[index].pid,
                                vid: videolist[index].vid,
                                token: videolist[index].token
                            }
                        })
                        //refreshPage()
                        return "toast://æ·»åŠ æˆåŠŸ"
                    } catch {
                        return "toast://ç½‘ç»œé”™è¯¯ï¼Œè¯·æ±‚å¤±è´¥"
                    }
                }, videolist),
                col_type: "text_5"
            })
        } catch {}
        //è®¢é˜…
        try {
            var userContainer = pdfh(html, "body&&.userContainer&&a&&Text");
            Apollo.d.push({
                title: userContainer.fontcolor("").bold().big(),
                img: pdfh(html, "body&&.userContainer&&img&&src"),
                desc: pdfh(html, "body&&.userContainer&&.userInfo&&Text"),
                url: Apollo.url + pdfh(html, "body&&.userContainer&&a&&href") + $('/videos##fypage')
                    .rule(() => {
                        const Apollo = $.require('hiker://page/Apollo')
                        Apollo.yijiParse(MY_URL.split("##")[0])
                        setResult(Apollo.d)
                    }),
                col_type: "avatar",
                extra: {
                    pageTitle: userContainer
                }
            })
            Apollo.d.push({
                col_type: "line",
            })
        } catch {}
        //æ˜æ˜Ÿ
        try {
            var tag = pdfa(html, ".pornstarsWrapper&&a")
            tag.forEach(item => {
                var url = Apollo.url + pdfh(item, "a&&href")
                Apollo.d.push({
                    title: pdfh(item, "Text"),
                    img: pdfh(item, "img&&src"),
                    url: "hiker://empty#" + url + $('/videos##fypage')
                        .rule(() => {
                            const Apollo = $.require('hiker://page/Apollo')
                            Apollo.yijiParse(MY_URL.split("##")[0])
                            setResult(Apollo.d)
                        }),
                    col_type: "card_pic_3",
                    extra: {
                        pageTitle: pdfh(item, "Text"),
                    }
                })
            })
        } catch {}
        //æ ‡ç­¾
        try {
            var list = pdfa(html, "body&&.tags.floatLeft&&a");
            list.forEach(item => {
                var vurl = Apollo.url + pdfh(item, 'a&&href');
                vurl = vurl.replace(/https?.*(https?.*)/, "$1")
                var title = pdfh(item, "a&&Text");
                Apollo.d.push({
                    title: 'â€œâ€œâ€â€' + title.fontcolor("#FFFFFF"),
                    url: "hiker://empty#" + vurl + $('##fypage')
                        .rule(() => {
                            const Apollo = $.require('hiker://page/Apollo')
                            Apollo.yijiParse(MY_URL.split("##")[0])
                            setResult(Apollo.d)
                        }),
                    col_type: "flex_button",
                    extra: {
                        pageTitle: title,
                        'backgroundColor': Apollo.getRangeColors()
                    }
                })
            })
        } catch {}
        //ç›¸å…³
        Apollo.d.push({
            title: "ç›¸å…³è§†é¢‘".fontcolor("#FF00FF").bold(),
            col_type: "rich_text"
        })
        Apollo.videoType(url, html)
        setResult(Apollo.d)
    },
    //æœç´¢
    searchParse: (url) => {
        keyword = url.split("##")[1]
        url = Apollo.url + "/video/search?search=" + keyword + "&page=" + MY_PAGE
        log(url)
        var html = fetch(url, {
            headers: {
                "cookie": fetchPC('hiker://files/rules/Apollo/Cookie/pornhub_cookie.txt') || '',
                "User-Agent": "Mozilla/5.0 (Linux; Android 12; PFVM10 Build/SP1A.210812.016; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/89.0.4389.72 MQQBrowser/6.2 TBS/046285 Mobile Safari/537.36",
            },
        });
        Apollo.videoType(url, html)
        setResult(Apollo.d)
    },

}

$.exports = Apollo